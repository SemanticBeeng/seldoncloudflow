apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: fraud-rest-tfserving
spec:
  name: fraudresttfserving
  protocol: tensorflow
  transport: rest
  predictors:
    - componentSpecs:
        - spec:
            containers:
              - args:
                  - --port=8500
                  - --rest_api_port=8501
                  - --model_name=fraud
                  - --model_base_path=/mnt/sharedLibs/models/fraud #s3://fdp-killrweather-data/kubeflow/fraud_detection/model/fraud
                image: tensorflow/serving:2.6.2
                name: fraud
                ports:
                  - containerPort: 8501
                    name: http
                resources:
                  limits:
                    cpu: "2"
                    memory: 2Gi
                  requests:
                    cpu: "1"
                    memory: 1Gi
                env:
#                  - name: "AWS_REGION"
#                    value: "eu-west-1"
#                  - name: "S3_REGION"
#                    value: "eu-west-1"
#                  - name: "S3_ENDPOINT"
#                    value: "s3.eu-west-1.amazonaws.com"
#                  - name: "S3_USE_HTTPS"
#                    value: "1"
#                  - name: "S3_VERIFY_SSL"
#                    value: "1"
#                  - name: "AWS_ACCESS_KEY_ID"
#                    valueFrom: { secretKeyRef: { name: "s3-credentials", key: "accessKey" } }
#                  - name: "AWS_SECRET_ACCESS_KEY"
#                    valueFrom: { secretKeyRef: { name: "s3-credentials", key: "secretKey" } }
                  - name: TRACING
                    value: '1'
                  - name: JAEGER_AGENT_HOST
                    valueFrom:
                      fieldRef:
                        fieldPath: status.hostIP
                  - name: JAEGER_AGENT_PORT
                    value: '5775'
                  - name: JAEGER_SAMPLER_TYPE
                    value: const
                  - name: JAEGER_SAMPLER_PARAM
                    value: '1'
                volumeMounts:
                  - mountPath: /mnt/sharedLibs
                    name: models-volume
            terminationGracePeriodSeconds: 1
            volumes:
              - name: models-volume
                persistentVolumeClaim:
                  claimName: nfs-pvc-cloudflow
      graph:
        name: fraud
        type: MODEL
        endpoint:
          service_port: 8501
      name: model
      replicas: 1
      svcOrchSpec:
        env:
          - name: TRACING
            value: '1'
          - name: JAEGER_AGENT_HOST
            valueFrom:
              fieldRef:
                fieldPath: status.hostIP
          - name: JAEGER_AGENT_PORT
            value: '5775'
          - name: JAEGER_SAMPLER_TYPE
            value: const
          - name: JAEGER_SAMPLER_PARAM
            value: '1'